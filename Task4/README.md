# **Task 4 ‚Äî ML & Data Pipeline –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏ –∞–Ω—Ç–∏—Ñ—Ä–æ–¥–∞**


## üìå **–§–∞–π–ª—ã –∑–∞–¥–∞–Ω–∏—è**
[–ö–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã](ML_Data_Pipeline.puml)
![–ö–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã](ML_Data_Pipeline.png)

#### üß© **–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ**

ML-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–≤–µ—Ä—Ö Kafka-—Ü–µ–Ω—Ç—Ä–∏—á–Ω–æ–π Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ ML:

* **Dynamic Pricing (surge pricing)**
* **Fraud Detection**
* **Demand Forecasting (–ø—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞ –ø–æ —Ä–∞–π–æ–Ω–∞–º)**
* **Driver Allocation (–≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è)**

ML-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é—Ç—Å—è —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑:

* Kafka Streams (real-time processing)
* Feature Store (Redis + ClickHouse)
* ML Inference (FastAPI + ONNX)
* Airflow + Spark –¥–ª—è batch-–æ–±—É—á–µ–Ω–∏—è

## ‚öôÔ∏è **–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö (Data Flow)**

### **1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -> —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ -> `Booking Service` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ:

```
BookingCreated
```

–≤ Kafka.

–¢–∞–∫–∂–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç:

* `DriverLocationUpdated`
* `PaymentStatusChanged`
* `ZoneEntered`
* `FraudEvent`
* `PricingEvent`

Kafka ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–ª–æ–π, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã.

### **2. Real-Time Feature Engineering (Kafka Streams)**

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:

* –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
* —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∏—á–∏ (ETA, —Å–ø—Ä–æ—Å/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –≥–æ—Ä—è—á–∏–µ –∑–æ–Ω—ã, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
* –ø–∏—à–µ—Ç —Ñ–∏—á–∏ –≤ –¥–≤–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

####  Online Feature Store (Redis)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º `ML Inference` –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö (5‚Äì10 ms) –∑–∞–ø—Ä–æ—Å–æ–≤.

####  Offline Feature Store (ClickHouse)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (batch processing).

### **3. ML Inference Service**

–í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–Ω–ª–∞–π–Ω-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å:

* `predict_price()` ‚Äî dynamic pricing
* `predict_fraud_score()` ‚Äî –∞–Ω—Ç–∏—Ñ—Ä–æ–¥
* `predict_best_driver()` ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª–µ–π

–î–ª—è —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å:

1. –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª—å (ONNX/PyTorch)
2. –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ñ–∏—á–∏ –∏–∑ Redis
3. –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º

### **4. ML Training Pipeline**

Batch-–ø–∞–π–ø–ª–∞–π–Ω –Ω–∞ **Airflow + Spark**:

* –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–∏—á–∏ –∏–∑ ClickHouse
* –≤—ã–ø–æ–ª–Ω—è–µ—Ç feature engineering
* –æ–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª—å
* –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ **model drift**
* –¥–µ–ø–ª–æ–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –º–æ–¥–µ–ª—å –≤ ML Inference

–û–±—É—á–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

* —Ä–∞–∑ –≤ 1 —á–∞—Å (pricing, demand)
* —Ä–∞–∑ –≤ 24 —á–∞—Å–∞ (fraud)

### **5. BI –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**

ClickHouse -> DataLens (OLAP –æ—Ç—á—ë—Ç—ã):

* —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å dynamic pricing
* fraud cases
* –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π
* –ø—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞

Kafka Streams —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞–µ—Ç real-time –º–µ—Ç—Ä–∏–∫–∏ –≤ BI.

### **6. Monitoring & Alerting**

–°—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

* Prometheus
* Grafana
* Kafka Exporter
* ML Inference Metrics

–ö–ª—é—á–µ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã:

* consumer lag
* inference latency > 20ms
* –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏
* feature staleness (online store)
* training failures

## **ML-–º–æ–¥–µ–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ**

| –ú–æ–¥–µ–ª—å                      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                          |
| --------------------------- | ----------------------------------- |
| **Dynamic Pricing Model**   | surge-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç, –æ—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ |
| **Fraud Detection Model**   | –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ            |
| **Demand Forecasting**      | –ø—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞ –ø–æ —Ä–∞–π–æ–Ω–∞–º           |
| **Driver Allocation Model** | –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è         |
